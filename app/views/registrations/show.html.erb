<div class="card top-card">

    <div class="card-header">
       <h2>Registration Details</h2>
    </div>

    <%= render partial: "details" %>
</div>

<% content_for :wide_table  do %>
    <div class="card">
        <div class="card-header">
            <div style="float:left;"><h2>Transactions for this Registration</h2></div>
        </div>

        <div class="card-body" style="padding:1rem 1rem 0rem 1rem">

            <div class="table-responsive">
              <table class="table table-striped table-sm table-hover table-bordered">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Status</th>
                    <th>Owner</th>
                    <th>Payer</th>
                    <th>Amount</th>
                    <th>Updated At</th>
                    <th>Refresh</th>
                  </tr>
                </thead>
                <tbody>
                    <% @registration.transactions.each do |t| %>
                        <tr>
                            <td><%= link_to t.transaction_id, transaction_path(t.id) %></td>
                            <td><%= t.status %></td>
                            <td><%= link_to t.owner.handle, t.owner %></td>
                            <td>
                                <% if t.payer_first_name.blank?  || t.payer_last_name.blank? %>
                                    Unspecified
                                <% else %>
                                    <%= t.payer_first_name + " " + t.payer_last_name %>
                                <% end %>
                            </td>
                            <td><%= format("$%.2f", t.amount) %></td>
                            <td><%= t.updated_local_time %>
                            <td><%= link_to 'Refresh', "/api/transaction/#{t.id}/refresh.js", 
                              remote: true, class: 'btn btn-primary btn-sm' %></td>
                        </tr>
                    <% end %>
                </tbody>
              </table>
            </div>
        </div>
    </div>
<% end %>

<% content_for :wide_table  do %>
    <div class="card">
        <div class="card-header">
          <% if @registration.registerable_type == "Student" %>
            <h2>Single Registrant</h2>
          <% else %>
            <h2>Members of Registered Group <%= link_to @registration.registerable.handle,
              @registration.registerable %></h2>
          <% end %>
        </div>

        <div class="card-body" style="padding:1rem 1rem 0rem 1rem">

            <div class="table-responsive">
              <table class="table table-striped table-sm table-hover table-bordered">
                <thead>
                  <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Occupation</th>
                    <th>Organization</th>
                  </tr>
                </thead>
                <tbody>
                    <% @registrants.each do |r| %>
                        <tr>
                            <td><%= link_to r.handle, r %></td>
                            <td><%= mail_to r.wp_email, r.wp_email %></td>
                            <td><%= r.occupation  %></td>
                            <td><%= r.organization %></td>
                            
                        </tr>
                    <% end %>
                </tbody>
              </table>
            </div>
        </div>
    </div>
<% end %>

<% content_for :sidebar do %>
  <div class="row">
    <div class="col-sm-12">
      <%= link_to 'Edit Registration', edit_registration_path(@registration),
        class: 'btn btn-sm btn-danger', method: :get %>
    </div>
  </div>
<% end %>
