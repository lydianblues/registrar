<div class="card top-card">

  <div class="card-header">
    <div style="float:left;"><h2>Transactions</h2></div>
    <div style="float:right;">
      <%= link_to 'New Transaction', new_transaction_path, class: 'btn btn-primary btn-md' %>
    </div>
  </div>

  <div class="card-body">

    <div class="table-responsive">
      <table id="transactions-table" class="table table-striped table-sm table-hover table-bordered">

        <thead>
          <tr>
            <th>ID</th>
            <th>Registration</th>
            <th>Owner</th>
            <th>Type</th>
            <th>Status</th>
            <th>Payer</th>
            <th>Amount</th>
            <th>Created</th>
            <th>Updated</th>
            <th>Refresh</th> 
          </tr>
        </thead>

        <tbody>
          <% @transactions.each do |t| %>
            <tr id="tid-<%= t.transaction_id %>" >
              <td><%= link_to t.transaction_id, t %></td>

              <td><%= link_to t.registration.code, t.registration %></td>

              <td><%= link_to t.registration.owner.wp_first_name + " " +
                t.registration.owner.wp_last_name, t.registration.owner %></td>

              <% if t.payment_instrument_type == 'paypal_account' %>
                <td>PayPal</td>
              <% else %>
                <td>Credit Card</td>
              <% end %>

              <td><%= t.short_status %></td>

              <td><%= t.payer_name %></td>

              <td><%= '$%.2f' % t.amount %></td>

              <td><%= t.created_local_time %></td>
              <td><%= t.updated_local_time %></td>
              
              <td><%= link_to 'Refresh', "/api/transaction/#{t.id}/refresh.js", 
                remote: true,
                class: 'btn btn-primary btn-sm' %></td>
              
            </tr>
          <% end %>
        </tbody>
      </table>
        
    </div>
  </div>
</div>

<script>

$('#transactions-table').dataTable( {
  processing: true,
  serverSide: true,
  ajax: {
    url: '/transactions/datatables',
    processing: true,
    serverSide: true
  },
  =begin
            ID
            Registration
            Owner
            Type
            Status
            Payer
            Amount
            Created
            Updated
            Refresh
=end
  columns: [
    {data: 'id'},
    {data: 'registration_link'},
    {data: 'owner_link'},
    {data: 'payment_type'},
    {data: 'status'},
    {data: 'payer_link'},
    {data: 'amount'},
    {data: 'created_at'},
    {data: 'updated_at'},
    {data: 'refresh_button', orderable: false, searchable: false }
  ],

} );

</script>
